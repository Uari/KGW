<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mybatis.mapper.MemberMapper">

    <update id="empInfoUpdate" parameterType="map">
        update emp
        set team_no = #{team_no  jdbcType = VARCHAR}
          ,emp_access = #{emp_access jdbcType = VARCHAR}
          ,emp_position = #{emp_position jdbcType = VARCHAR}
          ,sign_no = 0
          ,dayoff_cnt = 0
          ,emp_year = 0
          ,hire_date = #{hire_date  jdbcType = VARCHAR}
          ,emp_state = #{emp_state jdbcType = VARCHAR}
          ,password = #{password jdbcType = VARCHAR}
          ,name = #{name jdbcType = VARCHAR}
          ,email = #{email jdbcType = VARCHAR}
          ,birthdate = #{birthdate jdbcType = VARCHAR}
          ,phone_num = #{phone_num jdbcType = VARCHAR}
          ,mod_date = to_char(sysdate,'YYYY-MM-DD HH24:MI:SS')
          ,address = #{address jdbcType = VARCHAR}
          ,retire_date = #{retire_date jdbcType = VARCHAR}
        ,profile_img = #{profile_img jdbcType = VARCHAR}
        where emp_no = #{emp_no}
    </update>

    <insert id="memberInsert" parameterType="map">
        insert into emp(emp_no,team_no,emp_access,emp_position,sign_no,dayoff_cnt,emp_year,hire_date,emp_state,password,name,email,birthdate,phone_num,address,mod_date,reg_date,retire_date)
        values(emp_pk_seq.nextval,#{team_no},#{emp_access},#{emp_position},0,0,0,#{hire_date},#{emp_state},#{password},#{name},#{email},#{birthdate},#{phone_num},#{address},to_char(sysdate,'YYYY-MM-DD HH24:MI:SS'),to_char(sysdate,'YYYY-MM-DD HH24:MI:SS'),NULL)
    </insert>

    <select id="empList" parameterType="map" resultType="map">
        select e.emp_no,t.team_name,t.team_no, e.emp_access, e.emp_position, e.sign_no, e.dayoff_cnt, e.emp_year,e.hire_date, e.emp_state, e.reg_date, e.mod_date, e.password, e.name, e.email,e.phone_num,e.address,e.birthdate,e.retire_date
        from emp e JOIN team t ON e.team_no = t.team_no
        <where>
            <if test="emp_no!=null">AND e.emp_no=#{emp_no}</if>
            <if test="gubun!=null">
                <choose>
                    <when test='gubun.equals("name")'>
                        AND name LIKE '%'||#{keyword}||'%'
                    </when>
                    <when test='gubun.equals("emp_no")'>
                        AND emp_no LIKE '%'||#{keyword}||'%'
                    </when>
                    <when test='gubun.equals("team_name")'>
                        AND team_name LIKE '%'||#{keyword}||'%'
                    </when>
                </choose>
            </if>
        </where>
        order by e.emp_no desc
    </select>


</mapper>